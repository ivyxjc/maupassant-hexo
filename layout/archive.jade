extends base

block title
  if page.category
     title= page.category + ' | ' + config.title
  if page.tag
     title= page.tag + ' | ' + config.title
  if page.archive
     title= __('archive') + ' | ' + config.title
block content
  if page.category || page.tag
      h1.label-title=  __('reading_label', page.category || page.tag)
  .post
    .post-archive
        //Use lodash to classify posts. See https://lodash.com/docs#groupBy
        each posts, year in _.groupBy(page.posts.toArray(), function(p){return -p.date.format('YYYY')})
          h2= -year
            // ul.listing
            // for post in posts
            //   li
            //     span.date= post.date.format('YYYY/MM/DD')
            //     a(href=url_for(post.path), title=post.title)
            //       +title(post)
          for post in posts
            .post
              h2.post-title
                include _partial/helpers
                a(href=url_for(post.path))
                  +title(post)
              .post-meta= post.date.format(config.date_format)
              if theme.duoshuo
                a.ds-thread-count(data-thread-key=post.path, href=url_for(post.path) + '#comments')
              if theme.disqus
                a.disqus-comment-count(data-disqus-identifier=post.path, href=url_for(post.path) + '#disqus_thread')
              if post.description
                .post-content
                  != post.description
              else if post.excerpt
                .post-content
                  != post.excerpt
              else if post.content
                - var br = post.content.indexOf('\n')
                if br < 0
                  .post-content
                    != post.content
                else
                  .post-content
                    != post.content.substring(0, br)
              p(class='readmore')
                a(href=url_for(post.path))= __('Readmore')

  include _partial/paginator.jade
